/*!
 * bigdata (https://uab-energetics.github.io/bigdata-app/html/)
 * Copyright 2017 chrisrocco
 * Licensed under the Themeforest Standard Licenses
 */

function submitPaperUploadForm(){var formData=new FormData,file=$("#papersCSV")[0].files[0];formData.append("papersCSV",file),swal({title:"Uploading...",text:"Just a sec!",type:"info",showCancelButton:!0,showConfirmButton:!1,closeOnConfirm:!1,showLoaderOnConfirm:!0});var promise=DataService.uploadPapersCSV(localStorage.projectKey,formData);return promise.success(function(data){var newPaperCount=data.newPaperCount;swal({title:"Success!",text:"You have uploaded "+newPaperCount+" new papers",type:"success",showCancelButton:!1,confirmButtonClass:"btn-success",confirmButtonText:"OK",closeOnConfirm:!1},function(){window.location.reload()})}),promise.error(function(response){var error=response.responseJSON;switch(error.reason){case"columnCountError":swal({title:"Invalid File",text:"Invalid column count on line "+error.row,type:"error",showCancelButton:!1,confirmButtonClass:"btn-danger",confirmButtonText:"OK",closeOnConfirm:!1});break;case"parseFailure":swal({title:"Invalid File",text:"We couldn't even parse the thing!",type:"error",showCancelButton:!1,confirmButtonClass:"btn-danger",confirmButtonText:"OK",closeOnConfirm:!1});break;case"emptyFileError":swal({title:"That's.. Empty?",text:"Looks like you submitted an empty file!",type:"error",showCancelButton:!1,confirmButtonClass:"btn-danger",confirmButtonText:"OK",closeOnConfirm:!1})}}),!1}function init(){var bdActive=document.querySelector("#bd-active").content,bdPending=document.querySelector("#bd-pending").content,bdConflicted=document.querySelector("#bd-conflicted").content,bdComplete=document.querySelector("#bd-complete").content;DataService.loadManageProject(localStorage.projectKey).success(function(data){var projectObject=data.project,papers=data.papers;$("[data-projectname]").html(projectObject.name);for(var outlet=document.querySelector("#templateOutlet"),template=document.querySelector("#paperTemplate").content,i=0;i<papers.length;i++){var paper=papers[i];template.querySelector("[data-title]").textContent=paper.title,template.querySelector("[data-desc]").textContent=paper.description.substring(0,33)+"..",template.querySelector("[data-assignmentCount]").textContent=paper.assignmentCount;for(var statusOutlet=template.querySelector("[data-status]");statusOutlet.hasChildNodes();)statusOutlet.removeChild(statusOutlet.lastChild);switch(paper.status){case"active":template.querySelector("[data-status]").appendChild(bdActive.cloneNode(!0));break;case"pending":template.querySelector("[data-status]").appendChild(bdPending.cloneNode(!0));break;case"conflicted":template.querySelector("[data-status]").appendChild(bdConflicted.cloneNode(!0));break;case"complete":template.querySelector("[data-status]").appendChild(bdComplete.cloneNode(!0))}outlet.appendChild(template.cloneNode(!0))}initFooTable(),initDropify()})}function initFooTable(){$("#papersTable").footable(),$(".filter-ui-status").on("change",function(){var filtering=FooTable.get("#papersTable").use(FooTable.Filtering),filter=$(this).val();"none"===filter?filtering.removeFilter("status"):filtering.addFilter("status",filter,["status"]),filtering.filter()})}function initDropify(){$("#papersCSV").dropify({messages:{default:"Drag and drop a file here or click",replace:"Drag and drop or click to replace",remove:"Remove",error:"Ooops, something is off."},showErrors:!1})}!function(document,window,$){"use strict";var Site=window.Site;$(document).ready(function($){Site.run(),init()})}(document,window,jQuery);