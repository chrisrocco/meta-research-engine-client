/*!
 * bigdata (https://uab-energetics.github.io/bigdata-app/html/)
 * Copyright 2017 chrisrocco
 * Licensed under the Themeforest Standard Licenses
 */

function loadProjects(){for(var projectTemplate=document.querySelector("#projectPanel"),ul=document.querySelector("#project-ul");ul.hasChildNodes();)ul.removeChild(ul.lastChild);DataService.getProjectsData().success(function(data){for(var pr=0;pr<data.projects.length;pr++){var projectData=data.projects[pr];projectTemplate.content.querySelector("[data-name]").textContent=projectData.name,projectTemplate.content.querySelectorAll("[data-key]")[0].dataset.key=projectData._key,projectTemplate.content.querySelectorAll("[data-key]")[1].dataset.key=projectData._key,projectTemplate.content.querySelectorAll("[data-key]")[2].dataset.key=projectData._key,projectTemplate.content.querySelector("[data-rac]").textContent=projectData.registrationCode;var clone=projectTemplate.content.cloneNode(!0);ul.appendChild(clone)}})}function submitNewProjectForm(){var form=document.forms.createProjectForm,projectObject={name:form.name.value,description:form.description.value};DataService.postProject(projectObject).success(function(response){swal({title:"Project Created!",text:"Project Registration Code: "+response.registrationCode,type:"success",showCancelButton:!1,confirmButtonClass:"btn-success",confirmButtonText:"OK",closeOnConfirm:!1}),loadProjects()})}function openProjectEditor(buttonElement){swal({title:"Are you sure?",text:"Editing the project structure will make it hard to compare different versions!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, edit it!",closeOnConfirm:!1},function(){localStorage.projectKey=buttonElement.dataset.key,window.location="project-builder.html"})}function openProject(buttonElement){localStorage.projectKey=buttonElement.dataset.key,window.location="manage-project.html"}function inviteUser(buttonElement){var projectKey=buttonElement.dataset.key;swal({title:"Invite Collaborator",text:"Enter a collaborator's email:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"They must have an account",showLoaderOnConfirm:!0},function(inputValue){if(!1!==inputValue){if(""===inputValue)return swal.showInputError("You need to write something!"),!1;var promise=DataService.makeProjectOwner(projectKey,inputValue);promise.success(function(res){swal({title:"Authorization Granted!",text:"User "+res.newOwner+" now has access to "+res.projectName,type:"success",showCancelButton:!1,confirmButtonClass:"btn-success",confirmButtonText:"OK",closeOnConfirm:!1})}),promise.fail(function(res){400!==res.status||"NO_USER"!==res.responseJSON.status?409!==res.status?swal({title:"Opps...",text:"Something went wrong.",type:"error",showCancelButton:!1,confirmButtonClass:"btn-danger",confirmButtonText:"OK",closeOnConfirm:!1}):swal({title:"Wait a Minute!",text:"That user is already a collaborator",type:"warning",showCancelButton:!1,confirmButtonClass:"btn-warning",confirmButtonText:"OK",closeOnConfirm:!1}):swal({title:"No Account Found",text:"We don't have an account with that email registered",type:"warning",showCancelButton:!1,confirmButtonClass:"btn-warning",confirmButtonText:"OK",closeOnConfirm:!1})})}})}$(document).ready(function(){AppProjects.run(),loadProjects()});